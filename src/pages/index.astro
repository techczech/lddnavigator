---
import Layout from '../layouts/Layout.astro';
import HeroSection from '../components/HeroSection.astro';
import { difficulties } from '../data/difficulties';
import { behaviours } from '../data/behaviours';
import { strategies, getStrategy } from '../data/strategies';
import { getDifficulty } from '../data/difficulties';
import {
  UserRound,
  Puzzle,
  Lightbulb,
  Clock,
  Turtle,
  BookX,
  FileQuestion,
  CircleSlash,
  EyeOff,
  AlertTriangle,
  Scale,
  BrainCog,
  PlusCircle,
} from '@lucide/astro';

const featuredBehaviours = behaviours.slice(0, 6);

const behaviourIconMap: Record<string, string> = {
  'always-late': 'clock',
  'slow-reader': 'turtle',
  'avoids-reading': 'book-x',
  'cant-follow-instructions': 'file-question',
  'misunderstands-banter': 'circle-slash',
  'unusual-eye-contact': 'eye-off',
  'anxious-about-changes': 'alert-triangle',
  'pedantic-about-rules': 'scale',
  'cant-concentrate': 'brain-cog',
};

const behavioursData = featuredBehaviours.map(b => ({
  id: b.id,
  title: b.title,
  description: b.description.split('\n\n')[0],
  difficulty: b.difficulty,
  strategies: b.strategies.map(sId => {
    const s = getStrategy(sId);
    return s ? { id: s.id, title: s.title } : null;
  }).filter(Boolean),
  relatedDifficulties: b.relatedDifficulties.map(dId => {
    const d = getDifficulty(dId);
    return d ? { id: d.id, title: d.title } : null;
  }).filter(Boolean),
}));
---

<Layout title="Home">
  <HeroSection />

  <!-- Did You Know -->
  <section class="bg-white">
    <div class="max-w-4xl mx-auto px-4">
      <div class="bg-ldd-orange text-white py-3 px-5 flex items-center gap-3">
        <div class="font-bold text-sm whitespace-nowrap border-r border-white/40 pr-3">DID YOU<br/>KNOW?</div>
        <p class="text-xs leading-relaxed">
          You can avoid an anxiety attack by spending an extra few minutes informing a person with autism about a change to routine.
        </p>
      </div>
    </div>
  </section>

  <!-- Behaviour Navigator -->
  <section class="py-6 bg-white">
    <div class="max-w-4xl mx-auto px-4">
      <div class="border border-gray-300 rounded overflow-hidden">
        <div class="grid lg:grid-cols-5">
          <!-- Left: Behaviour/Difficulty/Strategies -->
          <div class="lg:col-span-3 p-5 space-y-5 border-r border-gray-300" id="behaviour-details">
            <!-- Behaviour -->
            <div class="flex gap-3">
              <div class="flex-shrink-0">
                <UserRound class="w-10 h-10 text-ldd-gray-dark stroke-[1.5]" />
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-sm text-ldd-gray-dark mb-1">Behaviour</h3>
                <p class="text-xs text-gray-600" id="behaviour-text">Your client is always late for meetings no matter how important.</p>
                <p class="text-xs text-gray-500 mt-1" id="behaviour-detail">Sometimes you feel like the client does not respect your time or does not care. You have told them not to be late, but they always are.</p>
              </div>
            </div>

            <!-- Difficulty -->
            <div class="flex gap-3">
              <div class="flex-shrink-0">
                <Puzzle class="w-10 h-10 text-ldd-gray-dark stroke-[1.5]" />
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-sm text-ldd-gray-dark mb-1">Difficulty</h3>
                <p class="text-xs text-gray-600" id="difficulty-text">Your client may have problems with reading notes, sequencing, understanding time or following instructions.</p>
                <p class="text-xs text-gray-500 mt-1" id="difficulty-detail">This could be a sign of dyslexia, dyspraxia or ADHD.</p>
              </div>
            </div>

            <!-- Strategies -->
            <div class="flex gap-3">
              <div class="flex-shrink-0">
                <Lightbulb class="w-10 h-10 text-ldd-gray-dark stroke-[1.5]" />
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-sm text-ldd-gray-dark mb-1">Strategies</h3>
                <p class="text-xs text-ldd-orange font-medium" id="strategies-text">Written reminders, Colour coded calendars with icons, mnemonic devices.</p>
                <p class="text-xs text-gray-500 mt-1">There are many strategies you can use. Focus on helping your client identify the right strategies for them.</p>
                <a href="/strategies" class="inline-flex items-center gap-1 mt-2 bg-ldd-green text-white px-3 py-1 rounded text-xs hover:bg-ldd-green-dark transition-colors">
                  More strategies <span class="text-[9px]">▶</span>
                </a>
              </div>
            </div>
          </div>

          <!-- Right: Behaviour list -->
          <div class="lg:col-span-2">
            {featuredBehaviours.map((behaviour, index) => {
              const iconName = behaviourIconMap[behaviour.id] || 'clock';
              return (
                <button
                  type="button"
                  data-behaviour-id={behaviour.id}
                  class:list={[
                    'behaviour-btn w-full flex items-center gap-2 px-3 py-2.5 text-xs font-medium text-left border-b last:border-b-0',
                    index === 0
                      ? 'bg-white text-ldd-gray-dark border-gray-200'
                      : 'bg-ldd-blue text-white border-ldd-blue-dark/30 hover:bg-ldd-blue-dark',
                  ]}
                >
                  {iconName === 'clock' && <Clock class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'turtle' && <Turtle class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'book-x' && <BookX class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'file-question' && <FileQuestion class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'circle-slash' && <CircleSlash class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'eye-off' && <EyeOff class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'alert-triangle' && <AlertTriangle class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'scale' && <Scale class="w-4 h-4 flex-shrink-0" />}
                  {iconName === 'brain-cog' && <BrainCog class="w-4 h-4 flex-shrink-0" />}
                  <span>{behaviour.title}</span>
                </button>
              );
            })}
            <a
              href="/behaviours"
              class="flex items-center gap-2 px-3 py-2.5 bg-ldd-green text-white text-xs font-medium hover:bg-ldd-green-dark"
            >
              <PlusCircle class="w-4 h-4" />
              <span>More</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- About This Site -->
  <section class="py-6 bg-ldd-gray-light">
    <div class="max-w-4xl mx-auto px-4">
      <div class="flex gap-4 items-start">
        <div class="bg-ldd-orange text-white px-3 py-1 rounded text-xs font-semibold whitespace-nowrap">About This Site</div>
        <div class="flex-1">
          <p class="text-xs text-gray-600 mb-2">
            This website helps you identify behaviours that may indicate a learning difficulty, understand what might be causing them, and find strategies to help. This is a recreation of the original 2013 site, released under a CC BY license.
          </p>
          <a href="/about" class="inline-flex items-center gap-1 bg-ldd-orange text-white px-3 py-1 rounded text-xs hover:bg-ldd-orange-dark transition-colors">
            More about this site <span class="text-[9px]">▶</span>
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script define:vars={{ behavioursData }}>
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('.behaviour-btn');
    const behaviourText = document.getElementById('behaviour-text');
    const behaviourDetail = document.getElementById('behaviour-detail');
    const difficultyText = document.getElementById('difficulty-text');
    const difficultyDetail = document.getElementById('difficulty-detail');
    const strategiesText = document.getElementById('strategies-text');

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.behaviourId;
        const data = behavioursData.find(b => b.id === id);
        if (!data) return;

        buttons.forEach(b => {
          b.classList.remove('bg-white', 'text-ldd-gray-dark', 'border-gray-200');
          b.classList.add('bg-ldd-blue', 'text-white', 'border-ldd-blue-dark/30');
        });
        btn.classList.remove('bg-ldd-blue', 'text-white', 'border-ldd-blue-dark/30');
        btn.classList.add('bg-white', 'text-ldd-gray-dark', 'border-gray-200');

        if (behaviourText) behaviourText.textContent = data.description;
        if (behaviourDetail) behaviourDetail.textContent = '';
        if (difficultyText) difficultyText.textContent = data.difficulty;
        if (difficultyDetail) {
          const diffs = data.relatedDifficulties.map(d => d.title).join(', ');
          difficultyDetail.textContent = diffs ? `This could be a sign of ${diffs}.` : '';
        }
        if (strategiesText) {
          const strats = data.strategies.map(s => s.title).join(', ');
          strategiesText.textContent = strats || 'Various strategies can help with this behaviour.';
        }
      });
    });
  });
</script>
