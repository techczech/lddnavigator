---
import Layout from '../../layouts/Layout.astro';
import PageHeader from '../../components/PageHeader.astro';
import ContentSection from '../../components/ContentSection.astro';
import NavigationSidebar from '../../components/NavigationSidebar.astro';
import { difficulties, getDifficulty } from '../../data/difficulties';
import { getBehaviour } from '../../data/behaviours';
import { getStrategy } from '../../data/strategies';

export function getStaticPaths() {
  return difficulties.map(diff => ({
    params: { id: diff.id },
  }));
}

const { id } = Astro.params;
const difficulty = getDifficulty(id);

if (!difficulty) {
  return Astro.redirect('/difficulties');
}

const sidebarItems = [
  { label: 'What is it?', href: '#what-is-it', icon: 'help', color: 'orange' as const, active: true },
  { label: 'What to look out for', href: '#look-out-for', icon: 'eye', color: 'blue' as const },
  { label: 'What to do', href: '#what-to-do', icon: 'thumbs-up', color: 'green' as const },
  { label: 'Who can help', href: '#who-can-help', icon: 'users', color: 'gray' as const },
  { label: 'FAQs', href: '#faqs', icon: 'info', color: 'gray' as const },
];
---

<Layout title={difficulty.title}>
  <PageHeader
    title={difficulty.title}
    icon="file-text"
    color="orange"
    breadcrumbs={[
      { label: 'Home', href: '/' },
      { label: 'Landing Page' },
    ]}
  />

  <section class="py-8">
    <div class="max-w-4xl mx-auto px-4">
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Main content -->
        <div class="lg:col-span-2 space-y-8">
          <ContentSection title="What is it?" icon="help" id="what-is-it">
            {difficulty.whatIsIt.split('\n\n').map(para => (
              <p>{para}</p>
            ))}
            <p class="mt-3">People with {difficulty.title.toLowerCase()} often also find it hard to:</p>
            <ul class="list-disc pl-6 space-y-1 mt-2">
              <li>quickly recall words</li>
              <li>follow directions that are given in large chunks instead of step by step</li>
            </ul>
            <p class="mt-3">This means that they will struggle in school. {difficulty.title} often <strong>co-occurs</strong> with other difficulties such as ADHD or dyspraxia.</p>
            <p class="mt-3">It is also possible for a person with autism to have {difficulty.title.toLowerCase()}.</p>
          </ContentSection>

          <ContentSection title="What to look out for" icon="eye" id="look-out-for">
            <p>{difficulty.title} is a <strong>hidden disability</strong> and cannot be reliably determined without a set of assessments performed by a certified assessor. However, many of the signs below may indicate {difficulty.title.toLowerCase()}. And even if the person is not {difficulty.title.toLowerCase()}, they can still benefit from the same strategies.</p>
            <p class="font-medium mt-4 mb-2">Look out for:</p>
            <ul class="list-disc pl-6 space-y-1">
              {difficulty.whatToLookOutFor.map(item => (
                <li>{item}</li>
              ))}
            </ul>
          </ContentSection>

          <ContentSection title="What to do" icon="thumbs-up" id="what-to-do">
            <p class="text-ldd-orange font-medium">
              {difficulty.whatToDo.slice(0, 3).map((item, i) => (
                <>{i > 0 && ', '}<a href={`/strategies/${item.toLowerCase().replace(/\s+/g, '-')}`} class="hover:underline">{item}</a></>
              ))}.
            </p>
            <p class="mt-3">Other strategies include:</p>
            <ul class="list-disc pl-6 space-y-1 mt-2">
              {difficulty.whatToDo.map(item => (
                <li>{item}</li>
              ))}
            </ul>

            <h3 class="font-semibold text-ldd-gray-dark mt-6 mb-3">Related strategies</h3>
            <div class="flex flex-wrap gap-2">
              {difficulty.relatedStrategies.map(strategyId => {
                const strategy = getStrategy(strategyId);
                return strategy && (
                  <a
                    href={`/strategies/${strategyId}`}
                    class="bg-ldd-green text-white px-3 py-1 rounded text-xs hover:bg-ldd-green-dark transition-colors"
                  >
                    {strategy.title}
                  </a>
                );
              })}
            </div>
          </ContentSection>

          <ContentSection title="Who can help" icon="users" id="who-can-help">
            {difficulty.resources && difficulty.resources.length > 0 ? (
              <ul class="space-y-2">
                {difficulty.resources.map(resource => (
                  <li class="flex items-center gap-2">
                    <span class="text-ldd-blue text-sm">
                      {resource.type === 'webpage' ? 'üåê' : 'üìÑ'}
                    </span>
                    {resource.url ? (
                      <a href={resource.url} target="_blank" rel="noopener noreferrer" class="text-ldd-blue hover:underline text-sm">
                        {resource.title}
                      </a>
                    ) : (
                      <span class="text-sm">{resource.title}</span>
                    )}
                  </li>
                ))}
              </ul>
            ) : (
              <p>Contact your local SEN specialist or disability support services for more information and support.</p>
            )}
          </ContentSection>

          {difficulty.faqs && difficulty.faqs.length > 0 && (
            <ContentSection title="FAQs" icon="info" id="faqs">
              <div class="space-y-4">
                {difficulty.faqs.map(faq => (
                  <div>
                    <h4 class="font-semibold text-ldd-gray-dark mb-1">{faq.question}</h4>
                    <p>{faq.answer}</p>
                  </div>
                ))}
              </div>
            </ContentSection>
          )}

          <!-- Related behaviours -->
          <div>
            <h2 class="text-lg font-semibold text-ldd-gray-dark mb-3">Related behaviours</h2>
            <div class="grid sm:grid-cols-2 gap-3">
              {difficulty.relatedBehaviours.map(behaviourId => {
                const behaviour = getBehaviour(behaviourId);
                return behaviour && (
                  <a
                    href={`/behaviours/${behaviourId}`}
                    class="block bg-white border border-gray-200 rounded p-3 hover:border-ldd-blue hover:shadow-sm transition-all text-sm"
                  >
                    <h3 class="font-semibold text-ldd-gray-dark mb-1">{behaviour.title}</h3>
                    <p class="text-xs text-gray-600 line-clamp-2">{behaviour.difficulty}</p>
                  </a>
                );
              })}
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="hidden lg:block">
          <NavigationSidebar items={sidebarItems} />
        </div>
      </div>
    </div>
  </section>
</Layout>
