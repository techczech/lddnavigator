---
import Layout from '../../layouts/Layout.astro';
import PageHeader from '../../components/PageHeader.astro';
import ContentSection from '../../components/ContentSection.astro';
import NavigationSidebar from '../../components/NavigationSidebar.astro';
import { strategies, getStrategy } from '../../data/strategies';
import { getDifficulty } from '../../data/difficulties';
import { getBehaviour } from '../../data/behaviours';
import { Clock, Sparkles } from '@lucide/astro';

export function getStaticPaths() {
  return strategies.map(strategy => ({
    params: { id: strategy.id },
  }));
}

const { id } = Astro.params;
const strategy = getStrategy(id);

if (!strategy) {
  return Astro.redirect('/strategies');
}

const sidebarItems = [
  { label: 'Strategy', href: '#strategy', icon: 'lightbulb', color: 'gray' as const, active: true },
  { label: 'Behaviours', href: '#behaviours', icon: 'footprints', color: 'green' as const },
  { label: 'Resources', href: '#resources', icon: 'folder', color: 'gray' as const },
];
---

<Layout title={strategy.title}>
  <PageHeader
    title={strategy.title}
    icon="calendar"
    color="green"
    breadcrumbs={[
      { label: 'Home', href: '/' },
      { label: 'Landing Page' },
    ]}
  />

  <section class="py-8">
    <div class="max-w-5xl mx-auto px-4">
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Main content -->
        <div class="lg:col-span-2 space-y-8">
          <ContentSection title="Strategy" icon="puzzle" id="strategy">
            {strategy.description.split('\n\n').map(para => (
              <p>{para}</p>
            ))}

            <p class="font-medium mt-4 mb-2">You can also try:</p>
            <ul class="list-disc pl-6 space-y-1">
              {strategy.howTo.map(item => (
                <li>{item}</li>
              ))}
            </ul>
          </ContentSection>

          <ContentSection title="Related difficulties and behaviours" icon="footprints" id="behaviours">
            <p class="mb-4">This strategy can be helpful with these difficulties and behaviours:</p>

            <div class="space-y-2 mb-6">
              {strategy.relatedBehaviours.map(behaviourId => {
                const behaviour = getBehaviour(behaviourId);
                return behaviour && (
                  <a
                    href={`/behaviours/${behaviourId}`}
                    class="flex items-center gap-2 text-ldd-blue hover:underline text-sm"
                  >
                    <Clock class="w-4 h-4 text-ldd-orange" />
                    {behaviour.title}
                  </a>
                );
              })}
              {strategy.relatedDifficulties.map(diffId => {
                const difficulty = getDifficulty(diffId);
                return difficulty && (
                  <a
                    href={`/difficulties/${diffId}`}
                    class="flex items-center gap-2 text-ldd-blue hover:underline text-sm"
                  >
                    <Sparkles class="w-4 h-4 text-ldd-orange" />
                    {difficulty.title}
                  </a>
                );
              })}
            </div>
          </ContentSection>

          <ContentSection title="Resources" icon="folder" id="resources">
            <p class="mb-4">Here are some resources you can draw on to help you with this strategy:</p>
            {strategy.resources && strategy.resources.length > 0 ? (
              <ul class="space-y-2">
                {strategy.resources.map(resource => (
                  <li class="flex items-center gap-2">
                    <span class="text-ldd-green text-sm">
                      {resource.type === 'download' ? 'ğŸ“…' : resource.type === 'webpage' ? 'ğŸŒ' : 'ğŸ“„'}
                    </span>
                    <a href="#" class="text-ldd-blue hover:underline text-sm">
                      {resource.title}
                    </a>
                  </li>
                ))}
              </ul>
            ) : (
              <ul class="space-y-2">
                <li class="flex items-center gap-2">
                  <span class="text-ldd-green text-sm">ğŸ“…</span>
                  <a href="#" class="text-ldd-blue hover:underline text-sm">Calendar templates</a>
                </li>
                <li class="flex items-center gap-2">
                  <span class="text-ldd-green text-sm">ğŸ”§</span>
                  <a href="#" class="text-ldd-blue hover:underline text-sm">Organization tips</a>
                </li>
              </ul>
            )}
          </ContentSection>
        </div>

        <!-- Sidebar -->
        <div class="hidden lg:block">
          <NavigationSidebar items={sidebarItems} />
        </div>
      </div>
    </div>
  </section>
</Layout>
