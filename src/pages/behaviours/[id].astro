---
import Layout from '../../layouts/Layout.astro';
import PageHeader from '../../components/PageHeader.astro';
import ContentSection from '../../components/ContentSection.astro';
import NavigationSidebar from '../../components/NavigationSidebar.astro';
import { behaviours, getBehaviour } from '../../data/behaviours';
import { getDifficulty } from '../../data/difficulties';
import { getStrategy } from '../../data/strategies';

export function getStaticPaths() {
  return behaviours.map(behaviour => ({
    params: { id: behaviour.id },
  }));
}

const { id } = Astro.params;
const behaviour = getBehaviour(id);

if (!behaviour) {
  return Astro.redirect('/behaviours');
}

const sidebarItems = [
  { label: 'Behaviour', href: '#behaviour', icon: 'footprints', color: 'green' as const, active: true },
  { label: 'Difficulty', href: '#difficulty', icon: 'puzzle', color: 'blue' as const },
  { label: 'Strategies', href: '#strategies', icon: 'lightbulb', color: 'orange' as const },
];
---

<Layout title={behaviour.title}>
  <PageHeader
    title={behaviour.title}
    icon="clock"
    color="orange"
    breadcrumbs={[
      { label: 'Home', href: '/' },
      { label: 'Landing Page' },
    ]}
  />

  <section class="py-8">
    <div class="max-w-4xl mx-auto px-4">
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Main content -->
        <div class="lg:col-span-2 space-y-8">
          <ContentSection title="Behaviour" icon="footprints" id="behaviour">
            <p class="font-medium text-ldd-gray-dark mb-3">Your client is {behaviour.title.toLowerCase()} no matter how important.</p>
            {behaviour.description.split('\n\n').map(para => (
              <p>{para}</p>
            ))}
          </ContentSection>

          <ContentSection title="Difficulty" icon="puzzle" id="difficulty">
            <p class="mb-4">Your client may have problems with reading notes, sequencing, understanding time or following instructions.</p>
            <p class="mb-4">{behaviour.difficulty}</p>

            <h3 class="font-semibold text-ldd-gray-dark mb-3">Related difficulties</h3>
            <div class="space-y-2">
              {behaviour.relatedDifficulties.map(diffId => {
                const difficulty = getDifficulty(diffId);
                return difficulty && (
                  <a
                    href={`/difficulties/${diffId}`}
                    class="flex items-center gap-2 text-ldd-blue hover:underline text-sm"
                  >
                    <span class="text-ldd-orange">‚è∞</span>
                    {difficulty.title}
                  </a>
                );
              })}
            </div>
          </ContentSection>

          <ContentSection title="Strategies" icon="puzzle" id="strategies">
            <p class="text-ldd-orange font-medium mb-3">
              {behaviour.strategies.slice(0, 3).map((stratId, i) => {
                const strategy = getStrategy(stratId);
                return strategy && (
                  <>{i > 0 && ', '}<a href={`/strategies/${stratId}`} class="hover:underline">{strategy.title}</a></>
                );
              })}.
            </p>
            <p class="mb-4">Other strategies include:</p>
            <ul class="list-disc pl-6 space-y-1 mb-6">
              {behaviour.strategies.map(stratId => {
                const strategy = getStrategy(stratId);
                return strategy && (
                  <li>{strategy.title}</li>
                );
              })}
            </ul>

            <div class="grid sm:grid-cols-2 gap-3">
              {behaviour.strategies.map(strategyId => {
                const strategy = getStrategy(strategyId);
                return strategy && (
                  <a
                    href={`/strategies/${strategyId}`}
                    class="block bg-white border border-gray-200 rounded p-3 hover:border-ldd-orange hover:shadow-sm transition-all text-sm"
                  >
                    <h3 class="font-semibold text-ldd-gray-dark mb-1">{strategy.title}</h3>
                    <p class="text-xs text-gray-600 line-clamp-2">{strategy.description}</p>
                  </a>
                );
              })}
            </div>
          </ContentSection>
        </div>

        <!-- Sidebar -->
        <div class="hidden lg:block">
          <NavigationSidebar items={sidebarItems} />
        </div>
      </div>
    </div>
  </section>
</Layout>
